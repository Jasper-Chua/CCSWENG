<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>Basket</title>
        <link href="/css/style.css" rel="stylesheet" type="text/css" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
        <script src="/js/index.js"></script>
    </head>

    <body class="mainBackground">
        <div class="header">
            <%- include("partials/logo") %>
            <div class="menu">
			    <%- include("partials/menubuttons") %>
            </div>
        </div>

        <div class="progressBarContainer">
            <%- include("partials/progressBar") %>
        </div>

        <form action="/orderComplete" method="POST">
            <div class="orderInfoSummary">
                <div class="orderInfoSummaryGroup">
                    <div>
                        <label class="orderSummaryStyle" for="buyerName">Buyer Name:</label>
                        <span class="orderSummaryInput"><%= orderInfo.name %></span>
                        <input type="hidden" name="name" placeholder="" value="<%= orderInfo.name %>">
                    </div>
                    <div>
                        <label class="orderSummaryStyle" for="orderNumber">Order ID:</label>
                        <span class="orderSummaryInput" id="orderID"><%= orderInfo.orderID %></span>
                        <input type="hidden" name="orderID" placeholder="" value="<%= orderInfo.orderID %>">
                    </div>
                </div>
                <div class="orderInfoSummaryGroup">
                    <div>
                        <label class="orderSummaryStyle" for="celebrantName">Celebrant Name:</label>
                        <span class="orderSummaryInput"><%= orderInfo.celebrant %></span>
                        <input type="hidden" name="celebrantName" placeholder="" value="<%= orderInfo.celebrant %>">
                    </div>
                    <div>
                        <label class="orderSummaryStyle" for="orderDate">Order Date:</label>
                        <span class="orderSummaryInput" id="orderDate"><%= orderInfo.orderDate %></span>
                        <input type="hidden" name="orderDate" placeholder="" value="<%= orderInfo.orderDate %>">
                    </div>
                </div>
                <div class="orderInfoSummaryGroup">
                    <div>
                        <label class="orderSummaryStyle" for="celebrantGender">Celebrant Gender:</label>
                        <span class="orderSummaryInput"><%= orderInfo.celebrantGender %></span>
                        <input type="hidden" name="celebrantGender" placeholder="" value="<%= orderInfo.celebrantGender %>">
                    </div>
                    <div>
                        <label class="orderSummaryStyle" for="payBy">Pay By:</label>
                        <span class="orderSummaryInput" id="orderPayBy"><%= orderInfo.payByDate %></span>
                        <input type="hidden" name="payBy" placeholder="" value="<%= orderInfo.payByDate %>">
                    </div>
                </div>
                <div>
                    <label class="orderSummaryStyle" for="celebrantAge">Celebrant Age:</label>
                    <span class="orderSummaryInput"><%= orderInfo.celebrantAge %></span>
                    <input type="hidden" name="celebrantAge" placeholder="" value="<%= orderInfo.celebrantAge %>">
                </div>
                <div>
                    <label class="orderSummaryStyle" for="pickupDate">Pickup Date:</label>
                    <span class="orderSummaryInput"><%= orderInfo.pickupDate %></span>
                    <input type="hidden" name="pickupDate" placeholder="" value="<%= orderInfo.pickupDate %>">
                </div>
                <div>
                    <label class="orderSummaryStyle" for="email">Email:</label>
                    <span class="orderSummaryInput"><%= orderInfo.email %></span>
                    <input type="hidden" name="email" placeholder="" value="<%= orderInfo.email %>">
                </div>
                <div>
                    <label class="orderSummaryStyle" for="contactNo">Contact Number:</label>
                    <span class="orderSummaryInput"><%= orderInfo.contactNo %></span>
                    <input type="hidden" name="contactNo" placeholder="" value="<%= orderInfo.contactNo %>">
                </div>
            </div>

            <div id="orderBasketSummary">
                <table class="orderBasketTableSummary">
                    <thead class="orderBasketTableSummaryHeader">
                        <tr>
                            <th class="orderBasketProductSummaryHeader" colspan="2">Product</th>
                            <th class="orderBasketQuantitySummaryHeader">Quantity</th>
                            <th class="orderBasketPriceSumamryHeader">Price</th>
                            <th class="orderBasketTotalSummaryHeader">Total</th>
                        </tr>
                    </thead>
                    <%_ productItemList.forEach(function(productItem) { _%>
                    <tbody>
                        <tr class="orderBasketProductSummaryRow">
                            <td class="orderBasketProductImageSummary" data-label="Product">
                                <div class="orderBasketProductImageContainer">
                                    <img src="<%= productItem.image %>" placeholder="trial" alt="1">
                                </div>
                            </td>
                            <td class="orderBasketProductInfoSummary" data-label="Product">
                            <table>
                                    <tr>
                                        <td>Name: <%= productItem.name %></td>
                                    </tr>
                                    <%_ if (productItem.type != 'cookie' && !productItem.cakeNumber) { _%>
                                    <tr>
                                        <td>Flavor: <%= productItem.flavor %></td>
                                    </tr>
                                    <%_ } _%>
                                    <%_ if (productItem.type == 'cake' && !productItem.cakeNumber) { _%>
                                    <tr>
                                        <td>Size: <%= productItem.size %></td>
                                    </tr>
                                    <%_ } _%>
                                    <%_ if (productItem.cakeNumber) { _%>
                                        <tr>
                                            <td>Cake Number: <%= productItem.cakeNumber %></td>
                                        </tr>
                                        <%_ } _%>
                                    <%_ if (productItem.type == 'cupcake') { _%>
                                    <tr>
                                        <td>Frosting: <%= productItem.frosting %></td>
                                    </tr>
                                    <%_ } _%>
                                    <%_ if (productItem.type != 'cake') { _%>
                                    <tr>
                                        <td>Design No: <%= productItem.designNumber %></td>
                                    </tr>
                                    <tr>
                                        <td>Design: <%= productItem.design %></td>
                                    </tr>
                                    <%_ } _%>
                                    <%_ if (productItem.type != 'cookie' && productItem.dedication && !productItem.cakeNumber) { _%>
                                    <tr>
                                        <td>Dedication: <%= productItem.dedication %></td>
                                    </tr>
                                    <%_ } _%>
                            </table>
                            </td>
                            <td class="orderBasketProductQuantitySummary" data-label="Quantity">
                                <%= productItem.quantity %>
                            </td>
                            <td class="orderBasketProductPriceSummary" data-label="Price">
                                <span>&#8369;<%= productItem.price %></span>
                            </td>
                            <td class="orderBasketProductTotalSummary" data-label="Total">
                                <span>&#8369;<%= parseInt(productItem.price) * parseInt(productItem.quantity)%></span>
                            </td>
                        </tr>
                    </tbody>
                    <%_ }) _%>
                    <tfoot>
                        <tr>
                            <td colspan="3"></td>
                            <td class="orderBasketTotalAmountSummaryLabel">Total Amount:</td>
                            <td class="orderBasketTotalAmountSummary" data-label="Total">
                                <span>&#8369;<%= totalPrice %></span>
                                <input type="hidden" name="totalPrice" value="<%= totalPrice %>">
                            </td>
                        </tr>
                    </tfoot>
                </table>
                <div class="orderBasketBtn">
                    <button class="orderBasketReturn">RETURN</button>
                    <button class="orderBasketSubmit">CHECK OUT</button>
                </div>
            </div>
        </form>
        <script>
            $(document).ready(function() {   
                //var date = new Date()
                //var orderID = ""
                //var orderDate = ""
                //var payByTemp = date
                //var payBy = ""
                const progressSteps = document.querySelectorAll('.progressStep');
                const progress = document.querySelector('.progress');
                progressSteps.forEach(function(progressSteps) {
                        if (progressSteps.classList.contains('progressStepActive')) {
                            progressSteps.classList.remove('progressStepActive')
                        }
                    })
                progressSteps[0].classList.add('progressStepActive')
                progressSteps[1].classList.add('progressStepActive')
                progressSteps[2].classList.add('progressStepActive')
                $('#progressImage1').find('img').attr('src', '/images/BrownCart.png')
                $('#progressImage2').find('img').attr('src', '/images/BrownForm.png')
                $('#progressImage3').find('img').attr('src', '/images/BrownCheck.png')

                const progressActive = document.querySelectorAll('.progressStepActive');

                progress.style.width = ((progressActive.length - 1) / (progressSteps.length - 1) * 100 + "%");

                /*
                if (date.getHours() < 10) {
                    orderID = orderID + '0'
                } 
                orderID = orderID + date.getHours()

                if (date.getMinutes() < 10) {
                    orderID = orderID + '0'
                }
                orderID = orderID + date.getMinutes()
                
                if (date.getSeconds() < 10) {
                    orderID = orderID + '0'
                }
                orderID = orderID + date.getSeconds()
                if (date.getMilliseconds() < 100 && date.getMilliseconds() >= 10) {
                    orderID = orderID + '0'
                } else if (date.getMilliseconds() < 10) {
                    orderID = orderID + '00'
                }
                orderID = orderID + date.getMilliseconds()
                orderID = orderID + $('input[name=name]').val()[0] + $('input[name=celebrantName]').val()[0] + $('input[name=celebrantGender]').val()[0]

                if (parseInt($('input[name=celebrantAge]').val()) < 100 && parseInt($('input[name=celebrantAge]').val()) >= 10) {
                    orderID = orderID + '0'
                } else if (parseInt($('input[name=celebrantAge]').val()) < 10) {
                    orderID = orderID + '00'
                }
                orderID = orderID + $('input[name=celebrantAge]').val()

                $('#orderID').text(orderID)
                $('input[name=orderID]').val(orderID)

                alert($('input[name=name]').val()[0])

                orderDate = getDate(date)
                $('#orderDate').text(orderDate)
                $('input[name=orderDate]').val(orderDate)
                payByTemp.setDate(date.getDate() + 7)
                payBy = getDate(payByTemp)
                $('#orderPayBy').text(payBy)
                $('input[name=payBy]').val(payBy)

                function getDate(date) {
                    var parseDate = ""

                    if (date.getMonth() + 1 < 10) {
                        parseDate = parseDate + '0'
                    }
                    parseDate = parseDate + (date.getMonth() + 1) + '-'

                    if (date.getDate() < 10) {
                        parseDate = parseDate + '0'
                    }
                    parseDate = parseDate + date.getDate() + '-'

                    parseDate = parseDate + date.getFullYear()
                    
                    return parseDate
                }
                */
            })
        </script>
    </body>

</html>